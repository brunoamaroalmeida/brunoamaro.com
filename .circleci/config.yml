version: 2
jobs:
  build:
    docker:
      - image: debian:stretch

    steps:
      - checkout
      - run:
          name: Install Hugo
          command: apt-get update && apt-get install git curl  -qy
      - run:
          name: Checkout Submodules if Needed
          command: |
            if [ -f ".gitmodules" ]; then
              git submodule sync
              git submodule update --force --recursive --init --remote
            fi
      - run:
          name: Generate Static Content
          command: hugo

      - run:
          name: Deploy
          command: cd public && find . -type f -exec curl -u ${username}:${password} ${ssl} --ssl-reqd --ftp-create-dirs -T {} ftp://${host}/{} \;
